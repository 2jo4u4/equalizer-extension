(()=>{"use strict";var e={464:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,u)}s((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SliderArray=void 0;const r=n(857),a=n(813),o=n(114),u=[];t.SliderArray=u,function(){i(this,void 0,void 0,(function*(){var e;const t=document.querySelector(`#${o.boardPanelID}`),n=null!==(e=yield r.Store.get("mainEqaulizerSetting"))&&void 0!==e?e:r.defFilter,i=document.createElement("div");i.id="btnContainer";const s=document.createElement("md-filled-button");s.innerText="重置",s.addEventListener("click",(function(){u.forEach(((e,t)=>{(0,r.sendMessageToCurrentTabs)("ctrl",{index:t+1,val:0}),e.value=0}))}));const c=document.createElement("md-outlined-button");c.innerText="保存",c.addEventListener("click",(function(){(0,r.sendMessageToCurrentTabs)("store-setting",null)}));const d=document.createElement("md-text-button");d.id=o.manualConnectMedia,d.innerText="掛載",d.addEventListener("click",(function(){(0,r.sendMessageToCurrentTabs)("connect",null)})),t.appendChild(i).append(c,s,d),n.forEach(((e,n)=>{const i=document.createElement("md-slider");i.step=.5,i.max=12,i.min=-12,i.value=e.init,i.labeled=!0,i.addEventListener("input",(function(){void 0!==i.value&&a.EmitEvent.sliderChange.notify(Object.assign(Object.assign({},e),{index:n+1,val:i.value}))}));const o=document.createElement("span");o.innerText=(0,r.hzToTitle)(e.hz);const s=document.createElement("div");t.appendChild(s).append(i,o),u.push(i)}))}))}()},813:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EmitEvent=void 0,function(e){e["滑桿調整"]="sliderChange"}(n||(n={}));class i{}t.EmitEvent=i,i.sliderChange={notify(e){document.body.dispatchEvent(new CustomEvent(n.滑桿調整,{detail:e}))},handle(e){document.body.addEventListener(n.滑桿調整,(function(t){e(t.detail)}))}}},803:()=>{},114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.manualConnectMedia=t.autoConnectMedia=t.settingPanelID=t.boardPanelID=t.homePanelID=t.settingTabsID=t.boardTabsID=t.homeTabsID=t.tabsID=void 0,t.tabsID="tabs",t.homeTabsID="home",t.boardTabsID="board",t.settingTabsID="setting",t.homePanelID="home-panel",t.boardPanelID="board-panel",t.settingPanelID="setting-panel",t.autoConnectMedia="auto-connect-media",t.manualConnectMedia="manual-connect-media"},640:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,u)}s((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(857),a=n(114);!function(){i(this,void 0,void 0,(function*(){const e=document.querySelector(`#${a.autoConnectMedia}`);e&&e.addEventListener("change",(function(){r.Store.set("autoConnectMedia",e.selected?1:0)}))}))}()},153:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,u)}s((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(114);!function(){i(this,void 0,void 0,(function*(){const e=document.querySelector("#tabs");if(e){const t=document.querySelector(`#${r.homePanelID}`),n=document.querySelector(`#${r.boardPanelID}`),i=document.querySelector(`#${r.settingPanelID}`);e.addEventListener("change",(function(r){t.hidden=0!==e.activeTabIndex,n.hidden=1!==e.activeTabIndex,i.hidden=2!==e.activeTabIndex}))}}))}()},237:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Equalizer=t.AudioContextWithMethod=void 0;class n{constructor(e){this.audioCtx=new AudioContext(e)}createBiquadFilter(){return this.audioCtx.createBiquadFilter()}allpass({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="allpass",i.frequency.value=e,i.Q.value=n,i}bandpass({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="bandpass",i.frequency.value=e,i.Q.value=n,i}highpass({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="highpass",i.frequency.value=e,i.Q.value=n,i}highshelf({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="highshelf",i.frequency.value=e,i.gain.value=t,i}lowpass({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="lowpass",i.frequency.value=e,i.Q.value=n,i}lowshelf({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="lowshelf",i.frequency.value=e,i.gain.value=t,i}notch({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="notch",i.frequency.value=e,i.Q.value=n,i}peaking({f:e,g:t,q:n}){const i=this.createBiquadFilter();return i.type="peaking",i.frequency.value=e,i.Q.value=n,i.gain.value=t,i}}t.AudioContextWithMethod=n,t.Equalizer=class{constructor(e){this.index=0,this.audio=new n,this.audioCtx=this.audio.audioCtx,this.queue=new Map,e&&(this.media=e),this.isStream=!1}addToQueue(e){this.index++;const t=this.index.toString();return this.queue.set(t,e),this}stream(e=this.media){if(!this.isStream&&e){this.media=e,this.source=this.audioCtx.createMediaElementSource(this.media);let t=this.source;this.queue.forEach((e=>{t.connect(e),t=e})),t.connect(this.audioCtx.destination),this.isStream=!0}}}},55:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defFilter=void 0,t.defFilter=[{hz:60,init:0,type:"peaking"},{hz:230,init:0,type:"peaking"},{hz:910,init:0,type:"peaking"},{hz:4e3,init:0,type:"peaking"},{hz:14e3,init:0,type:"peaking"}]},857:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageToEuqalizer=t.sendMessageToCurrentTabs=t.getCurrentTabs=t.hzToTitle=t.Store=t.defFilter=t.AudioContextWithMethod=t.Equalizer=void 0;var i=n(237);Object.defineProperty(t,"Equalizer",{enumerable:!0,get:function(){return i.Equalizer}}),Object.defineProperty(t,"AudioContextWithMethod",{enumerable:!0,get:function(){return i.AudioContextWithMethod}});var r=n(55);Object.defineProperty(t,"defFilter",{enumerable:!0,get:function(){return r.defFilter}});var a=n(302);Object.defineProperty(t,"Store",{enumerable:!0,get:function(){return a.Store}});var o=n(79);Object.defineProperty(t,"hzToTitle",{enumerable:!0,get:function(){return o.hzToTitle}}),Object.defineProperty(t,"getCurrentTabs",{enumerable:!0,get:function(){return o.getCurrentTabs}}),Object.defineProperty(t,"sendMessageToCurrentTabs",{enumerable:!0,get:function(){return o.sendMessageToCurrentTabs}}),Object.defineProperty(t,"sendMessageToEuqalizer",{enumerable:!0,get:function(){return o.sendMessageToEuqalizer}})},302:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,u)}s((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0,t.Store=class{static getAll(){return n(this,void 0,void 0,(function*(){return yield browser.storage.local.get()}))}static get(e){return n(this,void 0,void 0,(function*(){return yield browser.storage.local.get(e).then((t=>t[e]))}))}static set(e,t){return n(this,void 0,void 0,(function*(){browser.storage.local.set({[e]:t})}))}}},79:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(e){a(e)}}function u(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,u)}s((i=i.apply(e,t||[])).next())}))};function i(){return n(this,void 0,void 0,(function*(){return yield browser.tabs.query({active:!0,currentWindow:!0})}))}Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageToEuqalizer=t.sendMessageToCurrentTabs=t.getCurrentTabs=t.hzToTitle=void 0,t.hzToTitle=function(e){return e>=1e3?e/1e3+"K HZ":`${e} HZ`},t.getCurrentTabs=i,t.sendMessageToCurrentTabs=function(e,t){return n(this,void 0,void 0,(function*(){var n;const r=yield i();browser.tabs.sendMessage(null!==(n=r[0].id)&&void 0!==n?n:0,{type:e,data:t})}))},t.sendMessageToEuqalizer=function(e,t){return n(this,void 0,void 0,(function*(){browser.runtime.sendMessage({type:e,data:t})}))}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}(()=>{n(153),n(640),n(803);const e=n(464),t=n(857),i=n(813),r=n(114);browser.runtime.onMessage.addListener(((t,n)=>{switch(t.type){case"initUI":{const{fliter:n,isAutoConnect:i,isConnect:a}=t.data;e.SliderArray.forEach(((e,t)=>{e.value=n[t].init}));const o=document.querySelector(`#${r.autoConnectMedia}`);o&&(o.selected=i);break}case"hiddenConnectBtn":break;default:console.log("debug",t)}})),i.EmitEvent.sliderChange.handle((e=>{(0,t.sendMessageToCurrentTabs)("ctrl",e)})),(0,t.sendMessageToCurrentTabs)("open",null)})()})();